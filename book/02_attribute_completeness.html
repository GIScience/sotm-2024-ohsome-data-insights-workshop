
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Attribute Completeness for Street Surface Tags &#8212; SOTM 2024 ohsome-data-insights Workshop</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'book/02_attribute_completeness';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="HOT Tasking Manager project analysis" href="03_hot_tm_project_analysis.html" />
    <link rel="prev" title="Vandalism Detection for LineStrings" href="02_vandalism_detection.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/HeiGIT_Logo_compact.svg" class="logo__image only-light" alt="SOTM 2024 ohsome-data-insights Workshop - Home"/>
    <script>document.write(`<img src="../_static/HeiGIT_Logo_compact.svg" class="logo__image only-dark" alt="SOTM 2024 ohsome-data-insights Workshop - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Welcome to ohsome-data-insights Workshop @ SOTM 2024
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="00_motivation.html">Why should you be excited about <em>ohsome-data-insights</em>?</a></li>
<li class="toctree-l1"><a class="reference internal" href="00_MinIO_Object_Store.html">Connect to MinIO Object Store</a></li>
<li class="toctree-l1"><a class="reference internal" href="00_Iceberg_Catalog.html">Connect to Apache Iceberg</a></li>
<li class="toctree-l1"><a class="reference internal" href="00_data_structure.html">Data Structure</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Data Extraction</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="01a_Data_Extraction_DuckDB_PyIceberg.html">Download latest OSM data as GeoPackage</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Simple Data Analysis</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="02a_buildings_currentness_DuckDB_PyIceberg.html">Currentness of Buildings</a></li>
<li class="toctree-l1"><a class="reference internal" href="02_vandalism_detection.html">Vandalism Detection for LineStrings</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Attribute Completeness for Street Surface Tags</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Data Integration</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="03_hot_tm_project_analysis.html">HOT Tasking Manager project analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="03_mapillary_data_analysis.html">Mapillary Coverage Analysis</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Advanced Data Analysis</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="04_corporate_edits.html">Corporate Edits Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="04_Country_User_Activity_DuckDB_only.html">User activity map</a></li>
<li class="toctree-l1"><a class="reference internal" href="04_highways_timeline_DuckDB_only.html">Road Network Evolution</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Background</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="05_partitioning_and_sorting.html">Partitioning and Sorting</a></li>
<li class="toctree-l1"><a class="reference internal" href="02b_buildings_currentness_DuckDB_only.html">DuckDB: Currentness of Buildings</a></li>
<li class="toctree-l1"><a class="reference internal" href="01b_Data_Extraction_DuckDB_only.html">DuckDB: Data Extraction from <em>geo-sorted ohsome contributions</em></a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/GIScience/sotm-2024-ohsome-data-insights-workshop/blob/main/book/02_attribute_completeness.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/GIScience/sotm-2024-ohsome-data-insights-workshop" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/GIScience/sotm-2024-ohsome-data-insights-workshop/issues/new?title=Issue%20on%20page%20%2Fbook/02_attribute_completeness.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/book/02_attribute_completeness.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Attribute Completeness for Street Surface Tags</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#getting-started">Getting started</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#prepare-the-input-parameters-for-your-analysis">Prepare the input parameters for your analysis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#get-the-data">Get the Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#filter-and-process-data-with-duckdb">Filter and process data with DuckDB</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#proporation-of-roads-with-surface-tag">Proporation of Roads with Surface Tag</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#proporation-of-roads-with-surface-tag-per-road-type">Proporation of Roads with Surface Tag per Road Type</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#map-of-roads-with-missing-road-surface-information">Map of roads with missing road surface information</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="attribute-completeness-for-street-surface-tags">
<h1>Attribute Completeness for Street Surface Tags<a class="headerlink" href="#attribute-completeness-for-street-surface-tags" title="Link to this heading">#</a></h1>
<p>In this notebook we demonstrate how can assess the completeness of tags in OSM.</p>
<p>These are the steps you see further down:</p>
<ul class="simple">
<li><p>Set the connection parameters.</p></li>
<li><p>Prepare your input parameters, e.g. define area of interest and attribute filters.</p></li>
<li><p><strong>Download data</strong> using PyIceberg and DuckDB.</p></li>
<li><p>Filter and process data with DuckDB.</p></li>
<li><p>Visualize the results on a map.</p></li>
</ul>
<section id="getting-started">
<h2>Getting started<a class="headerlink" href="#getting-started" title="Link to this heading">#</a></h2>
<p>Set connection params.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>
<span class="n">load_dotenv</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="n">s3_user</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;S3_ACCESS_KEY_ID&quot;</span><span class="p">]</span>  <span class="c1"># add your user here</span>
<span class="n">s3_password</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;S3_SECRET_ACCESS_KEY&quot;</span><span class="p">]</span>  <span class="c1"># add your password here</span>
</pre></div>
</div>
</div>
</div>
<p>Configure DuckDB.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span><span class="nv">duckdb</span><span class="o">==</span><span class="m">1</span>.0.0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">duckdb</span>

<span class="n">con</span> <span class="o">=</span> <span class="n">duckdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
    <span class="n">config</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;threads&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
        <span class="s1">&#39;max_memory&#39;</span><span class="p">:</span> <span class="s1">&#39;8GB&#39;</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="n">con</span><span class="o">.</span><span class="n">install_extension</span><span class="p">(</span><span class="s2">&quot;spatial&quot;</span><span class="p">)</span>
<span class="n">con</span><span class="o">.</span><span class="n">load_extension</span><span class="p">(</span><span class="s2">&quot;spatial&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Set the connection params to Iceberg Rest Catalog.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span><span class="s2">&quot;pyiceberg[s3fs,duckdb,sql-sqlite,pyarrow]&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyiceberg.catalog.rest</span> <span class="kn">import</span> <span class="n">RestCatalog</span>

<span class="n">catalog</span> <span class="o">=</span> <span class="n">RestCatalog</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">,</span>
    <span class="o">**</span><span class="p">{</span>
        <span class="s2">&quot;uri&quot;</span><span class="p">:</span> <span class="s2">&quot;https://sotm2024.iceberg.ohsome.org&quot;</span><span class="p">,</span>
        <span class="s2">&quot;s3.endpoint&quot;</span><span class="p">:</span> <span class="s2">&quot;https://sotm2024.minio.heigit.org&quot;</span><span class="p">,</span>
        <span class="s2">&quot;py-io-impl&quot;</span><span class="p">:</span> <span class="s2">&quot;pyiceberg.io.pyarrow.PyArrowFileIO&quot;</span><span class="p">,</span>
        <span class="s2">&quot;s3.access-key-id&quot;</span><span class="p">:</span> <span class="n">s3_user</span><span class="p">,</span>
        <span class="s2">&quot;s3.secret-access-key&quot;</span><span class="p">:</span> <span class="n">s3_password</span><span class="p">,</span>
        <span class="s2">&quot;s3.region&quot;</span><span class="p">:</span> <span class="s2">&quot;eu-central-1&quot;</span>
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Set connection to MinIO object storage.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">DROP SECRET IF EXISTS &quot;__default_s3&quot;;</span>
<span class="s2">CREATE SECRET (</span>
<span class="s2">      TYPE S3,</span>
<span class="s2">      KEY_ID &#39;</span><span class="si">{</span><span class="n">s3_user</span><span class="si">}</span><span class="s2">&#39;,</span>
<span class="s2">      SECRET &#39;</span><span class="si">{</span><span class="n">s3_password</span><span class="si">}</span><span class="s2">&#39;,</span>
<span class="s2">      REGION &#39;eu-central-1&#39;,</span>
<span class="s2">      endpoint &#39;sotm2024.minio.heigit.org&#39;,</span>
<span class="s2">      use_ssl true,</span>
<span class="s2">      url_style &#39;path&#39;</span>
<span class="s2">  );</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="n">con</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>┌─────────┐
│ Success │
│ boolean │
├─────────┤
│ true    │
└─────────┘
</pre></div>
</div>
</div>
</div>
</section>
<section id="prepare-the-input-parameters-for-your-analysis">
<h2>Prepare the input parameters for your analysis<a class="headerlink" href="#prepare-the-input-parameters-for-your-analysis" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set iceberg table</span>
<span class="n">namespace</span> <span class="o">=</span> <span class="s1">&#39;geo_sort&#39;</span>
<span class="n">tablename</span> <span class="o">=</span> <span class="s1">&#39;contributions&#39;</span>
<span class="n">icebergtable</span> <span class="o">=</span> <span class="n">catalog</span><span class="o">.</span><span class="n">load_table</span><span class="p">((</span><span class="n">namespace</span><span class="p">,</span> <span class="n">tablename</span><span class="p">))</span>


<span class="c1"># Define status filter</span>
<span class="n">status</span> <span class="o">=</span> <span class="s1">&#39;latest&#39;</span>


<span class="c1"># Define location filter</span>
<span class="n">bboxes</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;heidelberg&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">8.629761</span><span class="p">,</span> <span class="mf">49.379556</span><span class="p">,</span> <span class="mf">8.742371</span><span class="p">,</span> <span class="mf">49.437890</span><span class="p">),</span>
    <span class="s1">&#39;nairobi&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">36.650938</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.444471</span><span class="p">,</span> <span class="mf">37.103887</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.163522</span><span class="p">),</span>
    <span class="s1">&#39;mannheim&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">8.41416</span><span class="p">,</span> <span class="mf">49.410362</span><span class="p">,</span> <span class="mf">8.58999</span><span class="p">,</span> <span class="mf">49.590489</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">selected_region</span> <span class="o">=</span> <span class="s1">&#39;mannheim&#39;</span>
<span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">bboxes</span><span class="p">[</span><span class="n">selected_region</span><span class="p">]</span>
<span class="n">area_of_interest_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;s3a://heigit-ohsome-sotm24/data/sample_data/</span><span class="si">{</span><span class="n">selected_region</span><span class="si">}</span><span class="s2">.geojson&quot;</span>


<span class="c1"># Define geometry type filter</span>
<span class="n">geometry_type</span> <span class="o">=</span> <span class="s1">&#39;LineString&#39;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="get-the-data">
<h2>Get the Data<a class="headerlink" href="#get-the-data" title="Link to this heading">#</a></h2>
<p>First, we do an iceberg table scan with a pre-filter. This is a fast way to download all potential OSM elements that are needed for our analysis.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="n">icebergtable</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span>
    <span class="n">row_filter</span><span class="o">=</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;status = &#39;</span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">&#39; &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;and geometry_type = &#39;</span><span class="si">{</span><span class="n">geometry_type</span><span class="si">}</span><span class="s2">&#39; &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;and (xmax &gt;= </span><span class="si">{</span><span class="n">xmin</span><span class="si">}</span><span class="s2"> and xmin &lt;= </span><span class="si">{</span><span class="n">xmax</span><span class="si">}</span><span class="s2">) &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;and (ymax &gt;= </span><span class="si">{</span><span class="n">ymin</span><span class="si">}</span><span class="s2"> and ymin &lt;= </span><span class="si">{</span><span class="n">ymax</span><span class="si">}</span><span class="s2">) &quot;</span>
    <span class="p">),</span>
    <span class="n">selected_fields</span><span class="o">=</span><span class="p">(</span>
        <span class="s2">&quot;osm_id&quot;</span><span class="p">,</span>
        <span class="s2">&quot;tags&quot;</span><span class="p">,</span>
        <span class="s2">&quot;length&quot;</span><span class="p">,</span>
        <span class="s2">&quot;geometry&quot;</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">)</span><span class="o">.</span><span class="n">to_duckdb</span><span class="p">(</span><span class="s1">&#39;raw_osm_data&#39;</span><span class="p">,</span><span class="n">connection</span><span class="o">=</span><span class="n">con</span><span class="p">)</span>

<span class="n">download_time</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;download took </span><span class="si">{</span><span class="n">download_time</span><span class="si">}</span><span class="s2"> sec.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>download took 14.455 sec.
</pre></div>
</div>
</div>
</div>
</section>
<section id="filter-and-process-data-with-duckdb">
<h2>Filter and process data with DuckDB<a class="headerlink" href="#filter-and-process-data-with-duckdb" title="Link to this heading">#</a></h2>
<p>Here we extract the tag values for highways and their correspoding road surface type (if mapped). We also clip the road geometry to the area of interest and calculate the length for the clipped geometry.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">DROP TABLE IF EXISTS osm_data;</span>
<span class="s2">CREATE TABLE osm_data AS</span>
<span class="s2">(</span>
<span class="s2">SELECT</span>
<span class="s2">    tags[&#39;highway&#39;][1] as highway_tag_value,</span>
<span class="s2">    tags[&#39;surface&#39;][1] as surface_tag_value,</span>
<span class="s2">    ST_GeomFromText(a.geometry) as osm_geom,</span>
<span class="s2">    CASE</span>
<span class="s2">        WHEN ST_Within(osm_geom, aoi.geom) THEN osm_geom</span>
<span class="s2">        ELSE ST_Intersection(osm_geom, aoi.geom)</span>
<span class="s2">    END as clipped_geometry,</span>
<span class="s2">    CASE</span>
<span class="s2">        WHEN ST_Within(osm_geom, aoi.geom) THEN length</span>
<span class="s2">        ELSE ST_Length_Spheroid(clipped_geometry) / 1000</span>
<span class="s2">    END as length_km</span>
<span class="s2">FROM</span>
<span class="s2">    raw_osm_data as a,</span>
<span class="s2">    st_read(&#39;</span><span class="si">{</span><span class="n">area_of_interest_file</span><span class="si">}</span><span class="s2">&#39;) as aoi</span>
<span class="s2">WHERE 1=1</span>
<span class="s2">    and tags[&#39;highway&#39;][1] is not null</span>
<span class="s2">    -- spatial filtering part</span>
<span class="s2">    and ST_Intersects(st_GeomFromText(a.geometry), aoi.geom)</span>
<span class="s2">)</span>
<span class="s2">;</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="n">con</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

<span class="n">processing_time</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;processing took </span><span class="si">{</span><span class="n">processing_time</span><span class="si">}</span><span class="s2"> sec.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "f8fe314c69ed4d42be7aabda0ff5d3de", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>processing took 4.59 sec.
</pre></div>
</div>
</div>
</div>
</section>
<section id="proporation-of-roads-with-surface-tag">
<h2>Proporation of Roads with Surface Tag<a class="headerlink" href="#proporation-of-roads-with-surface-tag" title="Link to this heading">#</a></h2>
<p>Let’s inspect how many roads have a surface tag.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT</span>
<span class="s2">    SUM(length_km) as length_km_total,</span>
<span class="s2">    SUM(CASE</span>
<span class="s2">      WHEN surface_tag_value IS NOT NULL THEN length_km</span>
<span class="s2">      ELSE 0</span>
<span class="s2">    END) as length_km_with_surface_tag,</span>
<span class="s2">    round(length_km_with_surface_tag / length_km_total, 3) as proportion_with_surface_tag</span>
<span class="s2">FROM osm_data</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="n">con</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>┌──────────────────┬────────────────────────────┬─────────────────────────────┐
│ length_km_total  │ length_km_with_surface_tag │ proportion_with_surface_tag │
│      double      │           double           │           double            │
├──────────────────┼────────────────────────────┼─────────────────────────────┤
│ 3285612.61274888 │          2259704.672583999 │                       0.688 │
└──────────────────┴────────────────────────────┴─────────────────────────────┘
</pre></div>
</div>
</div>
</div>
</section>
<section id="proporation-of-roads-with-surface-tag-per-road-type">
<h2>Proporation of Roads with Surface Tag per Road Type<a class="headerlink" href="#proporation-of-roads-with-surface-tag-per-road-type" title="Link to this heading">#</a></h2>
<p>We can break down by road type. For some road types the surface tag is mapped better than for others.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT</span>
<span class="s2">    highway_tag_value,</span>
<span class="s2">    SUM(length_km) as length_km_total,</span>
<span class="s2">    SUM(CASE</span>
<span class="s2">      WHEN surface_tag_value IS NOT NULL THEN length_km</span>
<span class="s2">      ELSE 0</span>
<span class="s2">    END) as length_km_with_surface_tag,</span>
<span class="s2">    round(length_km_with_surface_tag / length_km_total, 3) as proportion_with_surface_tag</span>
<span class="s2">FROM osm_data</span>
<span class="s2">GROUP BY highway_tag_value</span>
<span class="s2">ORDER BY length_km_total DESC</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">df</span><span class="p">()</span>

<span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>highway_tag_value</th>
      <th>length_km_total</th>
      <th>length_km_with_surface_tag</th>
      <th>proportion_with_surface_tag</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>service</td>
      <td>694704.602918</td>
      <td>278210.148166</td>
      <td>0.400</td>
    </tr>
    <tr>
      <th>1</th>
      <td>footway</td>
      <td>546853.269568</td>
      <td>307684.651441</td>
      <td>0.563</td>
    </tr>
    <tr>
      <th>2</th>
      <td>track</td>
      <td>477267.685579</td>
      <td>285274.586297</td>
      <td>0.598</td>
    </tr>
    <tr>
      <th>3</th>
      <td>residential</td>
      <td>464907.754558</td>
      <td>447053.629756</td>
      <td>0.962</td>
    </tr>
    <tr>
      <th>4</th>
      <td>path</td>
      <td>446605.435393</td>
      <td>343686.039051</td>
      <td>0.770</td>
    </tr>
    <tr>
      <th>5</th>
      <td>unclassified</td>
      <td>118270.021870</td>
      <td>97051.021870</td>
      <td>0.821</td>
    </tr>
    <tr>
      <th>6</th>
      <td>tertiary</td>
      <td>110620.269124</td>
      <td>109950.269124</td>
      <td>0.994</td>
    </tr>
    <tr>
      <th>7</th>
      <td>secondary</td>
      <td>83886.049524</td>
      <td>83724.049524</td>
      <td>0.998</td>
    </tr>
    <tr>
      <th>8</th>
      <td>primary</td>
      <td>70041.951266</td>
      <td>69604.951266</td>
      <td>0.994</td>
    </tr>
    <tr>
      <th>9</th>
      <td>living_street</td>
      <td>48703.000000</td>
      <td>42401.000000</td>
      <td>0.871</td>
    </tr>
    <tr>
      <th>10</th>
      <td>motorway</td>
      <td>47689.847847</td>
      <td>47511.847847</td>
      <td>0.996</td>
    </tr>
    <tr>
      <th>11</th>
      <td>cycleway</td>
      <td>36750.000000</td>
      <td>31285.000000</td>
      <td>0.851</td>
    </tr>
    <tr>
      <th>12</th>
      <td>trunk</td>
      <td>26581.871319</td>
      <td>25673.869133</td>
      <td>0.966</td>
    </tr>
    <tr>
      <th>13</th>
      <td>bridleway</td>
      <td>25781.881633</td>
      <td>18633.871521</td>
      <td>0.723</td>
    </tr>
    <tr>
      <th>14</th>
      <td>motorway_link</td>
      <td>18060.630577</td>
      <td>17632.630577</td>
      <td>0.976</td>
    </tr>
    <tr>
      <th>15</th>
      <td>trunk_link</td>
      <td>14148.107011</td>
      <td>13349.107011</td>
      <td>0.944</td>
    </tr>
    <tr>
      <th>16</th>
      <td>pedestrian</td>
      <td>12229.000000</td>
      <td>10507.000000</td>
      <td>0.859</td>
    </tr>
    <tr>
      <th>17</th>
      <td>secondary_link</td>
      <td>11996.000000</td>
      <td>11982.000000</td>
      <td>0.999</td>
    </tr>
    <tr>
      <th>18</th>
      <td>steps</td>
      <td>11948.002884</td>
      <td>5219.000000</td>
      <td>0.437</td>
    </tr>
    <tr>
      <th>19</th>
      <td>primary_link</td>
      <td>10418.000000</td>
      <td>10171.000000</td>
      <td>0.976</td>
    </tr>
    <tr>
      <th>20</th>
      <td>construction</td>
      <td>2905.231679</td>
      <td>620.000000</td>
      <td>0.213</td>
    </tr>
    <tr>
      <th>21</th>
      <td>tertiary_link</td>
      <td>1958.000000</td>
      <td>1902.000000</td>
      <td>0.971</td>
    </tr>
    <tr>
      <th>22</th>
      <td>corridor</td>
      <td>935.000000</td>
      <td>339.000000</td>
      <td>0.363</td>
    </tr>
    <tr>
      <th>23</th>
      <td>busway</td>
      <td>818.000000</td>
      <td>49.000000</td>
      <td>0.060</td>
    </tr>
    <tr>
      <th>24</th>
      <td>proposed</td>
      <td>612.000000</td>
      <td>0.000000</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>25</th>
      <td>platform</td>
      <td>441.000000</td>
      <td>0.000000</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>26</th>
      <td>raceway</td>
      <td>189.000000</td>
      <td>189.000000</td>
      <td>1.000</td>
    </tr>
    <tr>
      <th>27</th>
      <td>fi</td>
      <td>177.000000</td>
      <td>0.000000</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>28</th>
      <td>bus_stop</td>
      <td>82.000000</td>
      <td>0.000000</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>29</th>
      <td>street_lamp</td>
      <td>32.000000</td>
      <td>0.000000</td>
      <td>0.000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="map-of-roads-with-missing-road-surface-information">
<h2>Map of roads with missing road surface information<a class="headerlink" href="#map-of-roads-with-missing-road-surface-information" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>


<span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT</span>
<span class="s2">    highway_tag_value,</span>
<span class="s2">    surface_tag_value,</span>
<span class="s2">    CASE </span>
<span class="s2">       WHEN surface_tag_value IS NULL THEN &#39;missing&#39;</span>
<span class="s2">       WHEN list_contains([&#39;paved&#39;, &#39;asphalt&#39;, &#39;chipseal&#39;, &#39;concrete&#39;, &#39;concrete:lanes&#39;, &#39;concrete:plates&#39;, &#39;paving_stones&#39;, &#39;sett&#39;, &#39;unhewn_cobblestone&#39;, &#39;cobblestone&#39;, &#39;bricks&#39;, &#39;metal&#39;, &#39;wood&#39;], surface_tag_value) THEN &#39;paved&#39;</span>
<span class="s2">       WHEN list_contains([&#39;unpaved&#39;, &#39;compacted&#39;, &#39;fine_gravel&#39;, &#39;gravel&#39;, &#39;shells&#39;, &#39;rock&#39;, &#39;pebblestone&#39;, &#39;ground&#39;, &#39;dirt&#39;, &#39;earth&#39;, &#39;grass&#39;, &#39;grass_paver&#39;, &#39;metal_grid&#39;, &#39;mud&#39;, &#39;sand&#39;, &#39;woodchips&#39;, &#39;snow&#39;, &#39;ice&#39;, &#39;salt&#39;], surface_tag_value) THEN &#39;unpaved&#39;</span>
<span class="s2">       ELSE &#39;other&#39;</span>
<span class="s2">    END as surface_type,</span>
<span class="s2">    ST_AsText(clipped_geometry) as geometry</span>
<span class="s2">FROM osm_data</span>
<span class="s2">WHERE ST_GeometryType(clipped_geometry) = &#39;LINESTRING&#39;</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">df</span><span class="p">()</span>

<span class="c1"># convert the data to geodata</span>
<span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span>
    <span class="n">df</span><span class="p">,</span>
    <span class="n">geometry</span><span class="o">=</span><span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="o">.</span><span class="n">from_wkt</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">])</span>
<span class="p">)</span><span class="o">.</span><span class="n">set_crs</span><span class="p">(</span><span class="s1">&#39;epsg:4326&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Define map parameters and style.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">lonboard</span>
<span class="kn">from</span> <span class="nn">palettable.matplotlib</span> <span class="kn">import</span> <span class="n">Viridis_20</span>


<span class="n">gdf</span><span class="p">[</span><span class="s2">&quot;surface_type_codes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf</span><span class="p">[</span><span class="s2">&quot;surface_type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">codes</span>

<span class="n">surface_type_colormap</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;missing&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">228</span><span class="p">,</span><span class="mi">26</span><span class="p">,</span><span class="mi">28</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span>
    <span class="s2">&quot;other&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">152</span><span class="p">,</span><span class="mi">78</span><span class="p">,</span><span class="mi">163</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span>
    <span class="s2">&quot;paved&quot;</span><span class="p">:</span>  <span class="p">[</span><span class="mi">55</span><span class="p">,</span><span class="mi">126</span><span class="p">,</span><span class="mi">184</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span>
    <span class="s2">&quot;unpaved&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">77</span><span class="p">,</span><span class="mi">175</span><span class="p">,</span><span class="mi">74</span><span class="p">,</span> <span class="mi">255</span><span class="p">]</span>
<span class="p">}</span>


<span class="c1"># the lonboard map definition</span>
<span class="n">layer</span> <span class="o">=</span> <span class="n">lonboard</span><span class="o">.</span><span class="n">PathLayer</span><span class="o">.</span><span class="n">from_geopandas</span><span class="p">(</span>
    <span class="n">gdf</span><span class="p">,</span>
    <span class="n">get_color</span><span class="o">=</span><span class="n">lonboard</span><span class="o">.</span><span class="n">colormap</span><span class="o">.</span><span class="n">apply_categorical_cmap</span><span class="p">(</span><span class="n">gdf</span><span class="p">[</span><span class="s2">&quot;surface_type&quot;</span><span class="p">],</span> <span class="n">surface_type_colormap</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
    <span class="n">get_width</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span>
    <span class="n">width_units</span><span class="o">=</span><span class="s1">&#39;pixels&#39;</span><span class="p">,</span>
    <span class="n">extensions</span><span class="o">=</span><span class="p">[</span><span class="n">lonboard</span><span class="o">.</span><span class="n">layer_extension</span><span class="o">.</span><span class="n">DataFilterExtension</span><span class="p">(</span><span class="n">filter_size</span><span class="o">=</span><span class="mi">1</span><span class="p">)],</span>
    <span class="n">get_filter_value</span><span class="o">=</span><span class="n">gdf</span><span class="p">[</span><span class="s2">&quot;surface_type_codes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">),</span>  <span class="c1"># replace with desired column</span>
    <span class="n">filter_range</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">],</span>  <span class="c1"># replace with desired filter range</span>
<span class="p">)</span>


<span class="n">highway_map</span> <span class="o">=</span> <span class="n">lonboard</span><span class="o">.</span><span class="n">Map</span><span class="p">(</span>
    <span class="n">basemap_style</span><span class="o">=</span><span class="n">lonboard</span><span class="o">.</span><span class="n">basemap</span><span class="o">.</span><span class="n">CartoBasemap</span><span class="o">.</span><span class="n">Positron</span><span class="p">,</span>
    <span class="n">layers</span><span class="o">=</span><span class="p">[</span><span class="n">layer</span><span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Set toggle buttons for different road surface types.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ipywidgets</span>
<span class="kn">from</span> <span class="nn">traitlets</span> <span class="kn">import</span> <span class="n">directional_link</span>

<span class="n">group_options</span> <span class="o">=</span> <span class="p">[(</span><span class="n">key</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">surface_type_colormap</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="p">]</span>

<span class="n">surface_toggle</span> <span class="o">=</span> <span class="n">ipywidgets</span><span class="o">.</span><span class="n">ToggleButtons</span><span class="p">(</span>
    <span class="n">options</span><span class="o">=</span><span class="n">group_options</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Surface Type:&#39;</span><span class="p">,</span>
    <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">button_style</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="c1"># &#39;success&#39;, &#39;info&#39;, &#39;warning&#39;, &#39;danger&#39; or &#39;&#39;</span>
<span class="p">)</span>

<span class="n">directional_link</span><span class="p">(</span>
    <span class="p">(</span><span class="n">surface_toggle</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="s2">&quot;filter_range&quot;</span><span class="p">),</span>
    <span class="n">transform</span><span class="o">=</span> <span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;traitlets.traitlets.directional_link at 0x7ac9f815d6d0&gt;
</pre></div>
</div>
</div>
</div>
<p>Display the map. You can click on the buttons to change the surface type displayed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">highway_map</span><span class="p">,</span> <span class="n">surface_toggle</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "39a6c53aeac84834a1062fade2d3c2bd", "version_major": 2, "version_minor": 1}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "5a27c459925043a2a10267683ec5e86e", "version_major": 2, "version_minor": 0}</script></div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./book"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="02_vandalism_detection.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Vandalism Detection for LineStrings</p>
      </div>
    </a>
    <a class="right-next"
       href="03_hot_tm_project_analysis.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">HOT Tasking Manager project analysis</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#getting-started">Getting started</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#prepare-the-input-parameters-for-your-analysis">Prepare the input parameters for your analysis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#get-the-data">Get the Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#filter-and-process-data-with-duckdb">Filter and process data with DuckDB</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#proporation-of-roads-with-surface-tag">Proporation of Roads with Surface Tag</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#proporation-of-roads-with-surface-tag-per-road-type">Proporation of Roads with Surface Tag per Road Type</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#map-of-roads-with-missing-road-surface-information">Map of roads with missing road surface information</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By ohsome Team @ HeiGIT
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>